<!--
Web Based Configuration Tool for WB40NBT/WB45NBT
Joe Conley, joe.conley@lairdtech.com
Version: 0.76
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web based configuration tool for WB platform">
    <meta name="author" content="Joseph Conley:joe.conley@lairdtech.com">
    <link rel="icon" href="/assets/img/laird_logo.png">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="container">
	<br>
		<div class="row">
		<div class="hidden-xs col-sm-3 col-md-4"></div>	
		<div class="hidden-xs col-sm-4 col-md-4"><a class="brand"><img src="/assets/img/laird_logo.png"></a></div>
		<div class="hidden-xs col-sm-4 col-md-4"></div>	
		</div>
	<br>
	<nav class="navbar navbar-default" role="navigation">
		<ul class="nav nav-tabs nav-justified">
			<li><a href="/status.html">Status</a></li>
			<li class="active"><a href="/profileconfig.html">Profile Configuration</a></li>
			<li><a href="/globalconfig.html">Global Configuration</a></li>
			<li><a href="/about.html">About</a></li>
		</ul>
	
	<?php
		exec('sdc_cli status', $sdcstatus);
		$TitleStatus=ucwords(substr($sdcstatus[0],11));
		if (strlen($TitleStatus) == 9)
		{
			echo "<title>SCU - $TitleStatus</title>";
		}
		else
		{
			echo "<title>SCU - Enabled</title>";
		}
	?>
	<!-- Show profile -->
	<div class="panel panel-default">
	<div class="row panel-body">
	<div class="col-md-4 col-md-offset-2">
		<form class="btn-toolbar" action = "" method = "post">
				<br>
				<h2>Profile Configuration</h2>
				<select name='wbprofiles' multiple='multiple' style="width:198px">
				<?php
				exec("sdc_cli profile list | grep ACTIVE", $ActivePro);
				exec("sdc_cli profile list", $prolist);
				$listLen=count($prolist);
				$editprofile=$_POST["wbprofiles"];
				$editprofile=chop($editprofile,"ACTIVE");
				foreach ($ActivePro as $ActivePro)
					{
						if  (chop($ActivePro,"ACTIVE") == $editprofile)
							{
								echo "<option selected>";
								echo "$ActivePro";
								echo "</option>";
							}
						else
							{
								echo "<option>";
								echo "$ActivePro";
								echo "</option>";
							}
					}
				foreach ($prolist as $prolist)
				{
					if ($prolist != $ActivePro)
					{
						if ($prolist == $editprofile)
							{
								echo "<option selected>";
								echo "$prolist";
								echo "</option>";
							}
						else
							{
								echo "<option>";
								echo "$prolist";
								echo "</option>";
							}
					}
				}
				echo "</select>";
				?>
				<br>
				<br>
				<div class="row">
				<div class="btn-group btn-group-sm col-md-12">
				<button class="btn btn-primary " TYPE="submit" name="formActivate">Activate</button>
				<button class="btn btn-primary" TYPE="submit" name="formEdit">Edit</button>
				<button class="btn btn-primary" TYPE="submit" name="formAdd">Add</button>
				<button class="btn btn-primary" TYPE="submit" name="formScan">Scan</button>
				</div><!-- btn-group btn-group-sm -->
				<br>
				<br>
				<div class="btn-group btn-group-sm col-md-12">
				<button class="btn btn-primary" type="submit" name="formShow">&nbsp;Show&nbsp;</button>
				<button class="btn btn-primary" type="submit" name="formRemove">&nbsp;Remove&nbsp;</button>
				<button class="btn btn-primary" type="submit" name="formRename">Rename</button>
				</div><!-- btn-group btn-group-sm -->
				<br>
				<br>
				<div class="btn-group btn-group-xs col-md-12">
				<?php
				if (strlen($TitleStatus) == 9)
				{
				  ?> <button class="btn btn-success" type="submit" name="formEnable">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enable Radio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button> <?php
				}
				else
				{
				  ?> <button class="btn btn-danger" type="submit" name="formDisable">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disable Radio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button> <?php
				}
				?>
				</div>
				</div> <!-- nested row -->
		</form>	
	</div> <!-- col-md-4 col-md-offset-2 -->

	<!--
	<div class="col-md-4">
		<div class="alert alert-success">
		  <a href="#" class="alert-link">stuff</a>
		</div>
	</div> <!-- col-md-4 -->

	<div class="col-md-4 col-md-offset-1">
		<?php
		if (isset($_POST['formActivate']))
				{
					$wbprofilename=$_POST["wbprofiles"];
					$wbprofilename=chop($wbprofilename, "ACTIVE");
					if ($wbprofilename == "")
					{
						$wbprofilename=chop($ActivePro, "ACTIVE");
					}
					?>
					<div class="alert alert-success">
					<h4>Success!</h4>
					<?php
					echo "<h6>Activating profile $wbprofilename</h6>";
					exec("sdc_cli profile $wbprofilename activate", $ActivateOK);
					?>
					<meta http-equiv="refresh" content="1">
					</div>
					<?php
				}

		if (isset($_POST['formAdd']))
				{
				?>
					<br>
					<h2>Profile Add</h2>
					<form name='subAdd' action='' method='post'>
					<h6>Enter a unique name for this profile:</h6>
					<input type='text' name='NewProfile' value=''>
					<br>
					<br>
					<button class="btn btn-primary" type='submit' name='subAdded'>Submit</button>
					</form>
					<br>
					</div>
				<?php
				}
				if (isset($_POST['subAdded']))
				{
				?>
					<input type = "hidden" name = "NewProfile" value = "<?php echo $_POST['NewProfile']; ?>"/>
				<?php
					$NewProfile=$_POST["NewProfile"];
					if (strlen($NewProfile) == 0)
					{
						?>
						<script>
						alert("Failed to add profile:\nProfile name must contain\nat least one character.");
						</script>
						<?php
					}
					else
					{
						exec("sdc_cli profile list", $prolist);
						$listlength=sizeof($prolist);
						$templength=0;
						foreach ($prolist as $prolisted)
						{
							$rawprofile=chop($prolisted,"ACTIVE");
							if (strcasecmp($rawprofile,$NewProfile) != 0)
							{
								$templength++;	
							}
						}
						if ($listlength == $templength)
						{
							exec("sdc_cli profile $NewProfile add");
							?>
							<div class="alert alert-success">
							<h4>Success!</h4>
							<?php
							echo "<h6>Added profile $NewProfile</h6>";
							?>
							</div>
							<?php
							$editprofile=$NewProfile;
							echo "<form id=refresh action='' method = 'post'>";
							echo "<input type = 'hidden' name = 'wbprofiles' value = '$editprofile' />";
							echo "<input type = 'hidden' name = 'formEdit' value = '$formeditprofile' />";
							echo "</form>";
							echo "<script>document.getElementById('refresh').submit();</script>";
						}
						else
						{
							?>
							<script>
							alert("Failed to add profile:\nProfile name not unique");
							</script>
							<?php
						}
					}
					echo "<form id=refresh action='' method = 'post'>";
					echo "</form>";
					echo "<script>document.getElementById('refresh').submit();</script>";
				}


		if (isset($_POST['formScan']))
		{
		?>
			<?php
			exec("sdc_cli scan > sdccliscan &", $printScan);
			echo "<form id=refresh action='' method = 'post'>";
			?>
			<input type = "hidden" name = "formScanLoad" value = "formScanLoad"/>
			<script>document.getElementById('refresh').submit();</script>
		<?php
		}
		if (isset($_POST['formScanLoad']))
		{
		?>
			<br>
			<h2>Scanning, Please wait.</h2>
			<br>
			    <div class="progress progress-striped active">
			    <div class="progress-bar"  role="progressbar" style="width: 100%"></div>
			    </div>
			<form id=refresh action='' method = 'post'>
			<input type = "hidden" name = "formScanAdd" value = "formScanAdd"/>
			<script>
			 setTimeout(function(){document.getElementById('refresh').submit()},8000);
			</script>
			<?php
		}
		if (isset($_POST['formScanAdd']))
		{
		?>
			<br>
			<h2>Select a SSID and profile name:</h2>
			<?php
			$count=0;
			$valueSSID=1;
			$valueRSSI=5;
			$printScan=file("sdccliscan");
			echo "<br>";
			echo "<form name='ScanADD' action='' method='post'>";
			echo "<select name='ScanList' multiple>";
			while ($count < count($printScan)/8)
			{
				if (substr($printScan[$valueSSID],0,6) == "SSID: " && substr($printScan[$valueRSSI],0,6) == "RSSI: ")
				{
					$realSSID=substr($printScan[$valueSSID],6);
					$realRSSI=substr($printScan[$valueRSSI],6);
					echo "<option value='$realSSID'>$realSSID @ $realRSSI</option>";
				}	
				$valueSSID = $valueSSID + 8;
				$valueRSSI = $valueRSSI + 8;
			$count=$count + 1;
			}
			exec("rm sdccliscan");
			?>
			</select>
			<br>
			<br>
			<h6>Enter a unique name for this profile:</h6> 
			<input type='text' name='NewProfile'>
			<br>
			<br>
			<button class="btn btn-primary" type='submit' name='ScanSub'>Submit</button>
			</form>
			<?php
		}
		if (isset($_POST['ScanSub']))
		{
		?>
			<input type = "hidden" name = "ScanList" value = "<?php echo $_POST['ScanList']; ?>"/>
			<input type = "hidden" name = "NewProfile" value = "<?php echo $_POST['NewProfile']; ?>"/>
			<?php
			$ScanList=$_POST['ScanList'];
			$NewProfile=$_POST["NewProfile"];
			echo "<br>";
			if (strlen($NewProfile) == 0)
			{
				?>
				<script>
				alert("Failed to add profile:\nProfile name must contain\nat least one character.");
				</script>
				<?php
			}
			else
			{
				exec("sdc_cli profile list", $prolist);
				$listlength=sizeof($prolist);
				$templength=0;
				foreach ($prolist as $prolisted)
				{
					$rawprofile=chop($prolisted,"ACTIVE");
					if (strcasecmp($rawprofile,$NewProfile) != 0)
					{
						$templength++;	
					}
				}
				if ($listlength == $templength)
				{
					?>
					<div class="alert alert-success">
					<h4>Success!</h4>
					<?php
					exec("sdc_cli profile $NewProfile add");
					exec("sdc_cli profile $NewProfile set ssid $ScanList");
					echo "<h6>Added profile $NewProfile</h6>";
					?>
					<meta http-equiv="refresh" content="1">
					</div>
					<?php
					$editprofile=$NewProfile;
					echo "<form id=refresh action='' method = 'post'>";
					echo "<input type = 'hidden' name = 'wbprofiles' value = '$editprofile' />";
					echo "<input type = 'hidden' name = 'formEdit' value = '$formeditprofile' />";
					echo "</form>";
					echo "<script>document.getElementById('refresh').submit();</script>";
				}
				else
				{
					?>
					<script>
					alert("Failed to add profile:\nProfile name not unique");
					</script>
					<?php
				}
			}
		}


		if (isset($_POST['formShow']))
		{
			$wbprofilename=$_POST["wbprofiles"];
			$wbprofilename=chop($wbprofilename, "ACTIVE");
		?>
				<br>				
				<h2><?php echo "Profile $wbprofilename Show" ?></h2>
				<?php
				if ($wbprofilename == "")
				{
					$wbprofilename=chop($ActivePro, "ACTIVE");
				}
				exec("sdc_cli profile $wbprofilename show", $printPro);
				foreach ($printPro as $printPro)
				{
					echo "<h6>$printPro</h6>";
				}
		}

		if (isset($_POST['formRemove']))
		{
			$wbprofilename=$_POST["wbprofiles"];
			if ($wbprofilename == "")
			{
				$wbprofilename=chop($ActivePro, "ACTIVE");
			}
			if ($wbprofilename == chop($ActivePro, "ACTIVE"))
			{
				?>
				<script>
				alert("Error:\nCan not delete active profile");
				</script>
				<?php	
				echo '<meta http-equiv="refresh" content="0">';	
			}
			elseif ($wbprofilename == $ActivePro)
			{
				?>
				<script>
				alert("Error:\nCan not delete active profile");
				</script>
				<?php	
				echo '<meta http-equiv="refresh" content="0">';	
			}
			else
			{
				?>
				<div class="alert alert-warning">
				<h4>Warning!</h4>
				<?php 
				echo "Removed profile $wbprofilename";
				exec("sdc_cli profile $wbprofilename delete");
				?>
				</div>
				<meta http-equiv="refresh" content="1">
				<?php
			}
		}

		if (isset($_POST['formRename']))
				{
					$wbprofilename=$_POST["wbprofiles"];
					$wbprofilename=chop($wbprofilename, "ACTIVE");
					$editprofile=$wbprofilename;
					?>
						<br>
						<h2><?php echo "Rename Profile $wbprofilename" ?></h2>
						<?php
						if ($editprofile == "")
						{
							$editprofile=chop($ActivePro, "ACTIVE");
						}
						echo "<h6>What would you like to rename $editprofile to?</h6>";
						?>
						<form name='testEdit' action='' method='post'>
						<?php
						echo "<input type='text' name='renamed' value='$editprofile'>";
						?>
						<input type = "hidden" name = "wbprofiles" value = "<?php echo $_POST['wbprofiles']; ?>"/>
						<br>
						<br>
						<button class="btn btn-primary" type='submit' name='EditRename'>Submit</button>
						</form>
					<?php
				}
				if (isset($_POST['EditRename']))
				{
					$editprofile=$_POST["wbprofiles"];
					$editprofile=chop($editprofile, "ACTIVE");
					$renamed=$_POST["renamed"];
					?>
						<br>
						<h2><?php echo "Rename Profile $wbprofilename" ?></h2>
						<?php	
						if( $editprofile != $renamed)
						{
							if( strlen($renamed) != 0 )
							{
								if ($renamed != "")	
								{	
									?>
									<div class="alert alert-success">
									<h4>Warning!</h4>
									<?php
									exec("sdc_cli profile $editprofile rename $renamed");
									echo "$editprofile has been renamed to $renamed";
									?>
									</div>
									<meta http-equiv="refresh" content="1">
									<?php
								}
								else
								{
									?>
									<script>
									alert("Profile name cannot be blank");
									</script>
									<?php
								}
							}
							else
							{
								?>
								<script>
								alert("Profile name cannot be blank");
								</script>
								<?php
							}
						}
						else
						{
							?>
							<script>
							alert("Cannot rename to same name");
							</script>
							<?php	
						}

						echo '<meta http-equiv="refresh" content="1">';
						echo "<br>";
				}

		if (isset($_POST['formEnable']))
				{
				?>
				    <div class="alert alert-warning">
				      <h4>Warning!</h4>
				      Enabling Radio
				      <?php exec("sdc_cli enable"); ?>
				      <meta http-equiv="refresh" content="1">
				  </div>
				<?php
				}
		if (isset($_POST['formDisable']))
				{
				  ?>
				    <div class="alert alert-warning">
				      <h4>Warning!</h4>
				      Disabling Radio
				      <?php exec("sdc_cli disable"); ?>
				      <meta http-equiv="refresh" content="1">
				  </div>
				<?php
				}
		?>
	</div> <!-- col-md-4 -->
	</div> <!-- panel panel-default -->
	</div> <!-- row panel-body -->
	</nav> <!-- navbar navbar-default -->
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/bootstrap.min.js"></script>


  </body>
</html>
